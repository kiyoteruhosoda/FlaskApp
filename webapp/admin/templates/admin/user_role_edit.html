{% extends "base.html" %}
{% block title %}{{ _('Edit User Roles') }}{% endblock %}

{% block content %}
<h2>{{ _('Edit User Roles') }} - {{ user.email }}</h2>

<div class="card">
  <div class="card-body">
    <form method="post" action="{{ url_for('admin.user_change_role', user_id=user.id) }}">
      <div class="mb-3">
        <label class="form-label">{{ _('Current User') }}</label>
        <div class="form-control-plaintext">{{ user.email }}</div>
      </div>
      
      <div class="mb-3">
        <label class="form-label">{{ _('Current Roles') }}</label>
        <div>
          {% if user.roles %}
            {% for role in user.roles %}
              <span class="badge bg-secondary me-1">{{ role.name }}</span>
            {% endfor %}
          {% else %}
            <span class="text-muted">{{ _('No roles assigned') }}</span>
          {% endif %}
        </div>
      </div>

      <div class="mb-3">
        <label for="role" class="form-label">{{ _('Select New Role') }}</label>
        <select class="form-select" id="role" name="role" required>
          <option value="">{{ _('Choose a role...') }}</option>
          {% for role in roles %}
            <option value="{{ role.id }}" {% if user.roles and role.id in user.roles|map(attribute='id')|list %}selected{% endif %}>
              {{ role.name }}
              {% if role.permissions %}
                ({{ role.permissions|map(attribute='code')|join(', ') }})
              {% endif %}
            </option>
          {% endfor %}
        </select>
      </div>

      <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary">{{ _('Update Role') }}</button>
        <a href="{{ url_for('admin.user') }}" class="btn btn-secondary">{{ _('Cancel') }}</a>
      </div>
    </form>
  </div>
</div>

<div class="mt-4">
  <h5>{{ _('Available Roles and Permissions') }}</h5>
  <div class="row">
    {% for role in roles %}
    <div class="col-md-6 mb-3">
      <div class="card">
        <div class="card-header">
          <strong>{{ role.name }}</strong>
        </div>
        <div class="card-body">
          {% if role.permissions %}
            {% for perm in role.permissions %}
              <span class="badge bg-info me-1 mb-1">{{ perm.code }}</span>
            {% endfor %}
          {% else %}
            <span class="text-muted">{{ _('No permissions') }}</span>
          {% endif %}
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
</div>

{% endblock %}
