{% extends "base.html" %}
{% block title %}公開鍵配布 | {{ super() }}{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h3 mb-0">公開鍵配布</h1>
  <a class="btn btn-outline-secondary" href="{{ url_for('certs_ui.index') }}">一覧に戻る</a>
</div>
<p class="text-muted">JWKSエンドポイントへのリンクと現在公開中の鍵情報です。</p>

<div class="accordion" id="jwksAccordion">
  {% for info in usage_infos %}
  <div class="accordion-item">
    <h2 class="accordion-header" id="heading-{{ loop.index }}">
      <button class="accordion-button {% if not loop.first %}collapsed{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ loop.index }}" aria-expanded="{{ 'true' if loop.first else 'false' }}" aria-controls="collapse-{{ loop.index }}">
        {{ info.usage.value }} ({{ info.key_count }} keys)
      </button>
    </h2>
    <div id="collapse-{{ loop.index }}" class="accordion-collapse collapse {% if loop.first %}show{% endif %}" aria-labelledby="heading-{{ loop.index }}" data-bs-parent="#jwksAccordion">
      <div class="accordion-body">
        <p class="mb-2">エンドポイント: <code>{{ info.api_url }}</code></p>
        <div class="d-flex gap-2 mb-3">
          <a class="btn btn-sm btn-outline-primary" href="{{ info.api_url }}" target="_blank" rel="noopener">ブラウザで開く</a>
          <button type="button" class="btn btn-sm btn-outline-secondary" onclick="navigator.clipboard.writeText({{ info.api_url|tojson }})">URLをコピー</button>
        </div>
        <h6>JWKS JSON</h6>
        <pre class="bg-light p-2 rounded small">{{ info.jwks_json }}</pre>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}
