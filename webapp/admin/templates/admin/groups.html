{% extends "base.html" %}
{% block title %}{{ _('Group Management') }}{% endblock %}
{% block content %}
<h2>{{ _('Management') }}</h2>

<ul class="nav nav-tabs mb-4">
  <li class="nav-item">
    <a class="nav-link" href="{{ url_for('admin.user') }}">
      <i class="fas fa-users"></i> {{ _('User Management') }}
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{{ url_for('admin.google_accounts') }}">
      <i class="fab fa-google"></i> {{ _('Google Accounts') }}
    </a>
  </li>
  {% if current_user.can('service_account:manage') %}
  <li class="nav-item">
    <a class="nav-link" href="{{ url_for('admin.service_accounts') }}">
      <i class="fas fa-key"></i> {{ _('Service Accounts') }}
    </a>
  </li>
  {% endif %}
  <li class="nav-item">
    <a class="nav-link" href="{{ url_for('admin.show_config') }}">
      <i class="fas fa-cogs"></i> {{ _('Config Settings') }}
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link active" href="{{ url_for('admin.groups') }}">
      <i class="fas fa-layer-group"></i> {{ _('Groups') }}
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{{ url_for('admin.roles') }}">
      <i class="fas fa-user-tag"></i> {{ _('Roles') }}
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="{{ url_for('admin.permissions') }}">
      <i class="fas fa-shield-alt"></i> {{ _('Permissions') }}
    </a>
  </li>
</ul>

<div class="d-flex justify-content-between align-items-center mb-3">
  <h3 class="mb-0">{{ _('Group Management') }}</h3>
  <a href="{{ url_for('admin.group_add') }}" class="btn btn-success">
    <i class="fas fa-plus"></i> {{ _('Add Group') }}
  </a>
</div>

<div class="table-responsive">
  <table class="table table-bordered align-middle">
    <thead class="table-light">
      <tr>
        <th scope="col">ID</th>
        <th scope="col">{{ _('Name') }}</th>
        <th scope="col">{{ _('Parent Group') }}</th>
        <th scope="col">{{ _('Subgroups') }}</th>
        <th scope="col">{{ _('Members') }}</th>
        <th scope="col">{{ _('Actions') }}</th>
      </tr>
    </thead>
    <tbody>
      {% for group in groups %}
      <tr>
        <td>{{ group.id }}</td>
        <td>
          <div class="fw-semibold">{{ group.name }}</div>
          {% if group.description %}
          <div class="text-muted small">{{ group.description }}</div>
          {% endif %}
        </td>
        <td>
          {% if group.parent %}
            {{ group.parent.name }}
          {% else %}
            <span class="text-muted">{{ _('None') }}</span>
          {% endif %}
        </td>
        <td>
          {% if group.children %}
            <span class="badge bg-secondary">{{ group.children | length }}</span>
          {% else %}
            <span class="text-muted">0</span>
          {% endif %}
        </td>
        <td>
          {% if group.users %}
            <span class="badge bg-info text-dark">{{ group.users | length }}</span>
          {% else %}
            <span class="text-muted">0</span>
          {% endif %}
        </td>
        <td>
          <div class="admin-action-buttons">
            <a href="{{ url_for('admin.group_edit', group_id=group.id) }}" class="btn btn-primary btn-sm admin-action-button">
              <i class="fas fa-edit"></i>
              <span>{{ _('Edit') }}</span>
            </a>
            <form method="post" action="{{ url_for('admin.group_delete', group_id=group.id) }}" class="admin-action-form"
                  onsubmit="return confirm('{{ _('Are you sure you want to delete this group?') }}');">
              <button type="submit" class="btn btn-danger btn-sm admin-action-button">
                <i class="fas fa-trash"></i>
                <span>{{ _('Delete') }}</span>
              </button>
            </form>
          </div>
        </td>
      </tr>
      {% else %}
      <tr>
        <td colspan="6" class="text-center text-muted py-4">{{ _('No groups have been created yet.') }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
