{% extends "base.html" %}
{% block title %}{{ _('Certificate Details') }} | {{ super() }}{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div>
    <h1 class="h3 mb-0">{{ _('Certificate Details') }}</h1>
    <p class="text-muted mb-0">{{ _('KID') }}: <span class="font-monospace">{{ certificate.kid }}</span></p>
  </div>
  <div>
    {% if certificate.group_code %}
    <a class="btn btn-outline-secondary me-2" href="{{ url_for('certs_ui.group_detail', group_code=certificate.group_code) }}">{{ _('Back to Group') }}</a>
    {% else %}
    <a class="btn btn-outline-secondary me-2" href="{{ url_for('certs_ui.index') }}">{{ _('Back to List') }}</a>
    {% endif %}
    {% if not certificate.is_revoked %}
    <a class="btn btn-danger" href="{{ url_for('certs_ui.revoke', kid=certificate.kid) }}">{{ _('Revoke Certificate') }}</a>
    {% endif %}
  </div>
</div>

<div class="row g-4">
  <div class="col-lg-6">
    <div class="card shadow-sm h-100">
      <div class="card-header">{{ _('Metadata') }}</div>
      <div class="card-body">
        <dl class="row mb-0">
          <dt class="col-sm-4">{{ _('Usage') }}</dt>
          <dd class="col-sm-8">{{ certificate.usage_type.value }}</dd>
          <dt class="col-sm-4">{{ _('Issued At') }}</dt>
          <dd class="col-sm-8">{{ certificate.issued_at.strftime('%Y-%m-%d %H:%M:%S') if certificate.issued_at else '-' }}</dd>
          <dt class="col-sm-4">{{ _('Status') }}</dt>
          <dd class="col-sm-8">
            {% if certificate.is_revoked %}
            <span class="badge bg-secondary">{{ _('Revoked') }}</span>
            {% else %}
            <span class="badge bg-success">{{ _('Active') }}</span>
            {% endif %}
          </dd>
          <dt class="col-sm-4">{{ _('Revoked At') }}</dt>
          <dd class="col-sm-8">
            {% if certificate.revoked_at %}
            {{ certificate.revoked_at.strftime('%Y-%m-%d %H:%M:%S') }}
            {% else %}-{% endif %}
          </dd>
          <dt class="col-sm-4">{{ _('Revocation Reason') }}</dt>
          <dd class="col-sm-8">{{ certificate.revocation_reason or '-' }}</dd>
          <dt class="col-sm-4">{{ _('Subject') }}</dt>
          <dd class="col-sm-8">{{ subject or '-' }}</dd>
          <dt class="col-sm-4">{{ _('Issuer') }}</dt>
          <dd class="col-sm-8">{{ issuer or '-' }}</dd>
          <dt class="col-sm-4">{{ _('Key Usage') }}</dt>
          <dd class="col-sm-8">
            {% if certificate.key_usage %}
            <ul class="list-inline mb-0">
              {% for usage in certificate.key_usage %}
              <li class="list-inline-item">
                <span class="badge text-bg-light">{{ key_usage_labels.get(usage, usage) }}</span>
              </li>
              {% endfor %}
            </ul>
            {% else %}
            <span class="text-muted">-</span>
            {% endif %}
          </dd>
          <dt class="col-sm-4">{{ _('Extended Key Usage') }}</dt>
          <dd class="col-sm-8">
            {% if certificate.extended_key_usage %}
            <ul class="list-inline mb-0">
              {% for usage in certificate.extended_key_usage %}
              <li class="list-inline-item">
                <span class="badge text-bg-light">{{ extended_key_usage_labels.get(usage, usage) }}</span>
              </li>
              {% endfor %}
            </ul>
            {% else %}
            <span class="text-muted">-</span>
            {% endif %}
          </dd>
          <dt class="col-sm-4">{{ _('Validity Period') }}</dt>
          <dd class="col-sm-8">
            {% if not_before or not_after %}
            {{ not_before.strftime('%Y-%m-%d %H:%M:%S') if not_before else '-' }} {{ _('to') }} {{ not_after.strftime('%Y-%m-%d %H:%M:%S') if not_after else _('Unlimited') }}
            {% else %}
            <span class="text-muted">{{ _('Unlimited') }}</span>
            {% endif %}
          </dd>
        </dl>
      </div>
    </div>
  </div>
  <div class="col-lg-6">
    <div class="card shadow-sm mb-4">
      <div class="card-header">{{ _('Certificate (PEM)') }}</div>
      <div class="card-body">
        {% if certificate_pem %}
        <pre class="bg-light p-2 rounded small">{{ certificate_pem }}</pre>
        {% else %}
        <p class="text-muted mb-0">{{ _('No certificate is stored for this key.') }}</p>
        {% endif %}
      </div>
    </div>
    <div class="card shadow-sm">
      <div class="card-header">{{ _('JWK Information') }}</div>
      <div class="card-body">
        <pre class="bg-light p-2 rounded small">{{ jwk_json }}</pre>
      </div>
    </div>
  </div>
</div>
{% endblock %}
