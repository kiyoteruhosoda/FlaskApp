{% extends "base.html" %}
{% block title %}{{ _('Photo Picker') }}{% endblock %}

{% block content %}
<h2>{{ _('Photo Picker') }}</h2>
<p>
    <a href="{{ picker_uri }}" target="_blank" rel="noopener" class="btn btn-primary">{{ _('Open Photo Picker') }}</a>
</p>
<img src="{{ qr_data }}" alt="QR Code" class="mt-3">
<p>
    <a href="{{ url_for('photo_view.home', session_id=session_id) }}" target="_blank" rel="noopener" class="btn btn-secondary">{{ _('Open Photo View') }}</a>
</p>
<script>
  const rawInterval = {{ (poll_interval or 0)|tojson }};
  const sessionName = {{ session_name|tojson }};
  function parseInterval(v) {
    if (typeof v === 'string' && v.endsWith('s')) {
      return parseFloat(v) * 1000;
    }
    return parseInt(v);
  }
  const intervalMs = parseInterval(rawInterval);
  async function poll() {
    try {
      await fetch('/api/picker/session/mediaItems', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ sessionId: sessionName })
      });
    } catch (e) {
      console.error(e);
    }
  }
  if (intervalMs) {
    setInterval(poll, intervalMs);
  }
</script>
{% endblock %}
