{% extends "base.html" %}
{% block title %}{{ _('Certificate List') }} | {{ super() }}{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h3">{{ _('Certificate List') }}</h1>
  <div>
    <a class="btn btn-primary me-2" href="{{ url_for('certs_ui.generate') }}">
      <i class="bi bi-plus-circle me-1"></i>{{ _('Generate New') }}
    </a>
    <a class="btn btn-outline-secondary" href="{{ url_for('certs_ui.public_keys') }}">
      <i class="bi bi-link-45deg me-1"></i>{{ _('Public Key Distribution') }}
    </a>
  </div>
</div>

<form class="row gy-2 gx-3 align-items-center mb-4" method="get">
  <div class="col-auto">
    <label class="form-label" for="usage">{{ _('Usage') }}</label>
    <select class="form-select" id="usage" name="usage" onchange="this.form.submit()">
      <option value="">{{ _('All') }}</option>
      {% for value, label in usage_options %}
      <option value="{{ value }}" {% if selected_usage == value %}selected{% endif %}>{{ label }}</option>
      {% endfor %}
    </select>
  </div>
</form>

<div class="table-responsive">
  <table class="table table-striped align-middle">
    <thead>
      <tr>
        <th scope="col">KID</th>
        <th scope="col">{{ _('Usage') }}</th>
        <th scope="col">{{ _('Issued At') }}</th>
        <th scope="col">{{ _('Status') }}</th>
        <th scope="col">{{ _('Revoked At') }}</th>
        <th scope="col">{{ _('Actions') }}</th>
      </tr>
    </thead>
    <tbody>
      {% if certificates %}
        {% for cert in certificates %}
        <tr>
          <td class="font-monospace">{{ cert.kid }}</td>
          <td>{{ cert.usage_type.value }}</td>
          <td>{{ cert.issued_at.strftime('%Y-%m-%d %H:%M:%S') if cert.issued_at else '-' }}</td>
          <td>
            {% if cert.is_revoked %}
            <span class="badge bg-secondary">{{ _('Revoked') }}</span>
            {% else %}
            <span class="badge bg-success">{{ _('Active') }}</span>
            {% endif %}
          </td>
          <td>
            {% if cert.revoked_at %}
            {{ cert.revoked_at.strftime('%Y-%m-%d %H:%M:%S') }}
            {% else %}-{% endif %}
          </td>
          <td>
            <a class="btn btn-sm btn-outline-primary me-1" href="{{ url_for('certs_ui.detail', kid=cert.kid) }}">
              {{ _('View Details') }}
            </a>
            {% if not cert.is_revoked %}
            <a class="btn btn-sm btn-outline-danger" href="{{ url_for('certs_ui.revoke', kid=cert.kid) }}">
              {{ _('Revoke') }}
            </a>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      {% else %}
      <tr>
        <td colspan="6" class="text-center text-muted py-4">{{ _('No certificates available to display.') }}</td>
      </tr>
      {% endif %}
    </tbody>
  </table>
</div>
{% endblock %}
