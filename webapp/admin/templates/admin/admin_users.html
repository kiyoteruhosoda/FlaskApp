{% extends "base.html" %}
{% block title %}{{ _('User Management') }}{% endblock %}
{% block content %}
<h2>{{ _('User Management') }}</h2>
<div class="mb-3">
  <a href="{{ url_for('admin.user_add') }}" class="btn btn-success">{{ _('Add User') }}</a>
  <a href="{{ url_for('admin.show_config') }}" class="btn btn-info ms-2">{{ _('Show Config Settings') }}</a>
</div>
<table class="table table-bordered">
  <thead>
    <tr>
      <th>ID</th>
      <th>Email</th>
      <th>Roles</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for user in users %}
    <tr>
      <td>{{ user.id }}</td>
      <td>{{ user.email }}</td>
      <td>
        {% for role in user.roles %}
          <span class="badge bg-secondary">{{ role.name }}</span>
        {% endfor %}
      </td>
      <td>
        <form method="post" action="{{ url_for('admin.user_change_role', user_id=user.id) }}" class="d-inline">
          <select name="role" class="form-select form-select-sm d-inline w-auto" onchange="this.form.submit()">
            {% for role in roles %}
              <option value="{{ role.id }}" {% if role in user.roles %}selected{% endif %}>{{ role.name }}</option>
            {% endfor %}
          </select>
        </form>
        <form method="post" action="{{ url_for('admin.user_reset_totp', user_id=user.id) }}" class="d-inline" onsubmit="return confirm('Reset TOTP for this user?');">
          <button type="submit" class="btn btn-warning btn-sm">{{ _('Reset TOTP') }}</button>
        </form>
        <form method="post" action="{{ url_for('admin.user_delete', user_id=user.id) }}" class="d-inline" onsubmit="return confirm('Are you sure you want to delete this user?');">
          <button type="submit" class="btn btn-danger btn-sm">{{ _('Delete') }}</button>
        </form>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% endblock %}
