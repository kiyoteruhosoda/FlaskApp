{% extends "base.html" %}
{% block title %}{{ _('Public Key Distribution') }} | {{ super() }}{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h3 mb-0">{{ _('Public Key Distribution') }}</h1>
  <a class="btn btn-outline-secondary" href="{{ url_for('certs_ui.index') }}">{{ _('Back to List') }}</a>
</div>
<p class="text-muted">{{ _('Links to the JWKS endpoints and information about currently published keys.') }}</p>

<div class="accordion" id="jwksAccordion">
  {% for info in group_infos %}
  <div class="accordion-item">
    <h2 class="accordion-header" id="heading-{{ loop.index }}">
      <button class="accordion-button {% if not loop.first %}collapsed{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ loop.index }}" aria-expanded="{{ 'true' if loop.first else 'false' }}" aria-controls="collapse-{{ loop.index }}">
        {{ info.group_code }} â€“ {{ info.usage.value }} ({{ info.key_count }} keys)
      </button>
    </h2>
    <div id="collapse-{{ loop.index }}" class="accordion-collapse collapse {% if loop.first %}show{% endif %}" aria-labelledby="heading-{{ loop.index }}" data-bs-parent="#jwksAccordion">
      <div class="accordion-body">
        <p class="mb-2">{{ _('Endpoint') }}: <code>{{ info.api_url }}</code></p>
        <div class="d-flex gap-2 mb-3">
          <a class="btn btn-sm btn-outline-primary" href="{{ info.api_url }}" target="_blank" rel="noopener">{{ _('Open in Browser') }}</a>
          <button type="button" class="btn btn-sm btn-outline-secondary" onclick="navigator.clipboard.writeText({{ info.api_url|tojson }})">{{ _('Copy URL') }}</button>
        </div>
        <h6>{{ _('JWKS JSON') }}</h6>
        <pre class="bg-light p-2 rounded small">{{ info.jwks_json }}</pre>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}
