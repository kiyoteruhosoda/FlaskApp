{% extends "base.html" %}
{% block title %}{{ _('Reset Password') }} - {{ _('AppName') }}{% endblock %}
{% block body_attributes %} class="login-page"{% endblock %}

{% block content %}
<div class="login-container">
  <div class="login-card">
    <div class="login-header">
      <h1 class="login-title">{{ _('Reset Password') }}</h1>
      <p class="login-subtitle">{{ _('Enter your new password') }}</p>
    </div>
    
    <form method="post" class="login-form">
      <input type="hidden" name="token" value="{{ token }}">
      
      <div class="form-group">
        <label for="password" class="form-label">
          <i class="fas fa-lock"></i>
          {{ _('New Password') }}
        </label>
        <div class="input-wrapper password-toggle-wrapper">
          <input type="password" class="form-control" id="password" name="password"
                 placeholder="{{ _('Enter new password') }}" required autofocus minlength="8">
          <button type="button" class="toggle-password-btn" aria-label="{{ _('Show password') }}"
                  aria-pressed="false" aria-controls="password"
                  data-show-label="{{ _('Show password') }}"
                  data-hide-label="{{ _('Hide password') }}"
                  data-target="password">
            <i class="fas fa-eye"></i>
            <span class="visually-hidden">{{ _('Toggle password visibility') }}</span>
          </button>
          <div class="input-icon">
            <i class="fas fa-lock"></i>
          </div>
        </div>
        <small class="form-text text-muted">{{ _('Password must be at least 8 characters long') }}</small>
      </div>

      <div class="form-group">
        <label for="password_confirm" class="form-label">
          <i class="fas fa-lock"></i>
          {{ _('Confirm New Password') }}
        </label>
        <div class="input-wrapper password-toggle-wrapper">
          <input type="password" class="form-control" id="password_confirm" name="password_confirm"
                 placeholder="{{ _('Re-enter new password') }}" required minlength="8">
          <button type="button" class="toggle-password-btn" aria-label="{{ _('Show password') }}"
                  aria-pressed="false" aria-controls="password_confirm"
                  data-show-label="{{ _('Show password') }}"
                  data-hide-label="{{ _('Hide password') }}"
                  data-target="password_confirm">
            <i class="fas fa-eye"></i>
            <span class="visually-hidden">{{ _('Toggle password visibility') }}</span>
          </button>
          <div class="input-icon">
            <i class="fas fa-lock"></i>
          </div>
        </div>
      </div>

      <button type="submit" class="btn btn-login">
        <i class="fas fa-check" style="margin-right: 8px;"></i>
        {{ _('Reset Password') }}
      </button>
    </form>
    
    <div class="forgot-password">
      <a href="{{ url_for('auth.login') }}">{{ _('Back to Login') }}</a>
    </div>
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Password toggle functionality
  const toggleButtons = document.querySelectorAll('.toggle-password-btn');
  toggleButtons.forEach(button => {
    button.addEventListener('click', function() {
      const targetId = this.getAttribute('data-target');
      const input = document.getElementById(targetId);
      const icon = this.querySelector('i');
      
      if (input.type === 'password') {
        input.type = 'text';
        icon.classList.remove('fa-eye');
        icon.classList.add('fa-eye-slash');
        this.setAttribute('aria-pressed', 'true');
        this.setAttribute('aria-label', this.getAttribute('data-hide-label'));
      } else {
        input.type = 'password';
        icon.classList.remove('fa-eye-slash');
        icon.classList.add('fa-eye');
        this.setAttribute('aria-pressed', 'false');
        this.setAttribute('aria-label', this.getAttribute('data-show-label'));
      }
    });
  });

  // Enhanced focus effects
  const inputs = document.querySelectorAll('.form-control');
  inputs.forEach(input => {
    input.addEventListener('focus', function() {
      this.parentElement.classList.add('focused');
    });
    
    input.addEventListener('blur', function() {
      this.parentElement.classList.remove('focused');
    });
  });

  // Password match validation
  const form = document.querySelector('.login-form');
  const password = document.getElementById('password');
  const passwordConfirm = document.getElementById('password_confirm');
  
  form.addEventListener('submit', function(e) {
    if (password.value !== passwordConfirm.value) {
      e.preventDefault();
      passwordConfirm.setCustomValidity('{{ _("Passwords do not match") }}');
      passwordConfirm.reportValidity();
    }
  });
  
  passwordConfirm.addEventListener('input', function() {
    if (this.value === password.value) {
      this.setCustomValidity('');
    } else {
      this.setCustomValidity('{{ _("Passwords do not match") }}');
    }
  });
});
</script>
{% endblock %}
