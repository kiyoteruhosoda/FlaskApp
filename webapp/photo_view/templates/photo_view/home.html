{% extends 'base.html' %}
{% block title %}Photo View{% endblock %}
{% block content %}
<h1>Photo View Home</h1>

<div class="mb-3">
  <button id="btn-picker-start" class="btn btn-primary">{{ _('Googleから追加') }}</button>
  <button id="btn-import-start" class="btn btn-secondary d-none">{{ _('インポート開始') }}</button>
</div>
<div id="import-status" class="mt-3"></div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  let pickerSessionId = null;
  const startBtn = document.getElementById('btn-picker-start');
  const importBtn = document.getElementById('btn-import-start');
  const statusEl = document.getElementById('import-status');

  startBtn.addEventListener('click', async () => {
    try {
      const resp = await fetch('/api/picker/session', {method: 'POST'});
      if (!resp.ok) {
        alert('Failed to create session');
        return;
      }
      const data = await resp.json();
      pickerSessionId = data.pickerSessionId;
      window.open(data.pickerUri, '_blank', 'noopener');
      importBtn.classList.remove('d-none');
    } catch (err) {
      console.error(err);
      alert('Failed to create session');
    }
  });

  importBtn.addEventListener('click', async () => {
    if (!pickerSessionId) {
      return;
    }
    try {
      const resp = await fetch(`/api/picker/session/${pickerSessionId}/import`, {method: 'POST'});
      if (!resp.ok) {
        alert('Failed to start import');
        return;
      }
      statusEl.textContent = '{{ _('インポートを開始しました') }}';
    } catch (err) {
      console.error(err);
      alert('Failed to start import');
    }
  });
});
</script>
{% endblock %}
