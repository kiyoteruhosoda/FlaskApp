<!DOCTYPE html>
<html>

  <head>
    <title>{{title}}</title>
    <link href="{{swagger_ui_url}}swagger-ui.css" rel="stylesheet" type="text/css"/>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
</head>

 <body>

   <div id="swagger-ui-container"></div>

   <script src="{{swagger_ui_url}}swagger-ui-standalone-preset.js"></script>
   <script src="{{swagger_ui_url}}swagger-ui-bundle.js"></script>
   <script>

     config = {
       url: "{{ spec_url }}",
       dom_id: '#swagger-ui-container'
     }

     var override_config = {{ swagger_ui_config | tojson }};
     for (var attrname in override_config) { config[attrname] = override_config[attrname]; }

     const initialServers = {{ servers | tojson }};
     window.__INITIAL_OPENAPI_SERVERS__ = initialServers;

     function sanitizeServerOptions() {
       var selectElements = document.querySelectorAll('select[aria-label="Servers"]');
       if (!selectElements || selectElements.length === 0) {
         return;
       }

       Array.prototype.forEach.call(selectElements, function(select) {
         if (!select) {
           return;
         }

         var options = select.querySelectorAll('option');
         if (!options || options.length === 0) {
           return;
         }

         Array.prototype.forEach.call(options, function(option) {
           if (!option) {
             return;
           }

           var rawValue = null;
           if (typeof option.value === 'string') {
             rawValue = option.value;
           } else if (typeof option.getAttribute === 'function') {
             rawValue = option.getAttribute('value');
           }

           if (typeof rawValue === 'string') {
             var sanitizedValue = rawValue.replace(/\\:/g, ':').replace(/\\\//g, '/');
             if (sanitizedValue !== rawValue) {
               option.value = sanitizedValue;
               if (typeof option.setAttribute === 'function') {
                 option.setAttribute('value', sanitizedValue);
               }
             }
           }

           var text = option.textContent;
           if (typeof text === 'string') {
             var sanitizedText = text.replace(/\\:/g, ':').replace(/\\\//g, '/');
             if (sanitizedText !== text) {
               option.textContent = sanitizedText;
             }
           }
         });
       });
     }

     function observeServerDropdown() {
       if (typeof MutationObserver === 'undefined') {
         return;
       }

       var observer = new MutationObserver(function() {
         sanitizeServerOptions();
       });

       function connectObserver() {
         var select = document.querySelector('select[aria-label="Servers"]');
         if (!select) {
           setTimeout(connectObserver, 100);
           return;
         }

         observer.observe(select, {
           childList: true,
           subtree: true,
           attributes: true,
           characterData: true,
         });

         sanitizeServerOptions();
       }

       connectObserver();
     }

     var existingOnComplete = config.onComplete;

     config.onComplete = function() {
       if (typeof existingOnComplete === 'function') {
         existingOnComplete.apply(this, arguments);
       }
       var system = null;
       if (window.ui && typeof window.ui.getSystem === 'function') {
         system = window.ui.getSystem();
       } else if (this && typeof this.getSystem === 'function') {
         system = this.getSystem();
       }
       if (system && typeof system.getStore === 'function') {
         var store = system.getStore();
         if (store && typeof store.subscribe === 'function') {
           store.subscribe(sanitizeServerOptions);
         }
       }
       observeServerDropdown();
       sanitizeServerOptions();
       setTimeout(sanitizeServerOptions, 0);
       setTimeout(sanitizeServerOptions, 100);
       setTimeout(sanitizeServerOptions, 250);
     };

     window.onload = function() {
       window.ui = SwaggerUIBundle(config)
     }
   </script>

 </body>

</html>
